# login to hpc (use your user name)
ssh user-name@hpc-login

#start a session. You can choose time and mem needed for your job (hierarchical mapping can take a long time and a lot of memory) 
srun -c 50 --mem=500G -t 60:00:00 -p celltypes --pty bash

# TO RUN IN INTERACTIVE RSTUDIO SESSION

mkdir $TMPDIR/{var,tmp}

# in order to make sure no dependency issues arise run RStudio from a docker container
# only have to pull a container once. For consequent sessions you can use the pulled version
singularity pull docker://alleninst/mapping_on_hpc

# start rstudio session (make sure path to docker image is correct
PASSWORD='rstudio' singularity exec --bind="$TMPDIR/var/:/var" --bind="$TMPDIR/tmp:/tmp" --bind "/sys/fs/cgroup/:/sys/fs/cgroup/" /home/michael.kunst/docker/mapping_on_hpc_latest.sif rserver --auth-none=1 --auth-minimum-user-id=500 --auth-pam-helper-path=pam-helper --www-address=0.0.0.0 --www-port=8585 --server-user michael.kunst

#in a new terminal window type (update user name and node number)
ssh -N -L 8585:n270:8585 michael.kunst@hpc-login

#go to webbrowser and type
localhost:8585

